@model TeamCatApp.ViewModel.AssignProjectViewModel
    
@{
    ViewBag.Title = "Assign Projects";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Assign Projects</h2>
<form>
    <div class="form-group">
        @Html.LabelFor(vm => vm.Team)
        @Html.DropDownListFor(vm => vm.Team, new SelectList(Model.Teams, "Id","TeamName"),"--SELECT TEAM--", new {@class="form-control", @id="ddlTeams"})
    </div>
    
    <div class="form-group">
        @Html.LabelFor(vm=>vm.Users)
        @Html.DropDownListFor(vm=>vm.Users, new SelectList(string.Empty,"Value","Text"),"--SELECT EMPLOYEE--", new {@class="form-control", @id="ddlUsers"})
    </div>

    <div clas="form-group">
        @Html.LabelFor(vm=>vm.Date)
        @Html.TextBoxFor(vm=>vm.Date, new {@class="form-control"})
    </div>
    
    <div class="form-group">
        @Html.LabelFor(vm => vm.Frequencies)
        @Html.DropDownListFor(vm => vm.Frequencies, new SelectList(Model.Frequencies, "Frequncy"), "--SELECT PROJECT FREQUENCY", new { @class = "form-control", @id="ddlFrequencies" })
    </div>

    <div class="form-group">
        @Html.LabelFor(vm => vm.Project)
        @Html.DropDownListFor(vm=>vm.Projects, new SelectList(string.Empty, "Value","Text"),"--SELECT PROJECT--", new {@class="form-control", @id="ddlProjects"})
    </div>

    <div class="form-group">
        @Html.LabelFor(vm=>vm.AssignedHour)
        @Html.TextBoxFor(vm=>vm.AssignedHour, new {@class="form-control"})
    </div>

    <button class="btn btn-primary" type="submit" >Add</button>
    
    <h2>GridView</h2>
    
    <button class="btn btn-success" type="submit">Save</button>
</form>


@section scripts {
    
    <script>
        $(document).ready(function () {
            $("#ddlTeams").change(function () {
                var teamId = $("#ddlTeams").val();
                $("#ddlUsers").empty();

                var json = { teamId: teamId }
                console.log(json);
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("GetUsersByTeamId","AssignProjects")',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(json),
                    success: function (data) {
                        $.each(data, function (key, value) {
                            $("#ddlUsers").append('<option value=' + value.Id + '>' + value.UserName + '</option>');
                        });
                    }
                });
            });

            // For populating frequency to project dropdownlist
            $("#ddlFrequencies").change(function() {
                var freqName = $("#ddlFrequencies").val();
                $("#ddlProjects").empty();
                var json = { frequncy: freqName }

                $.ajax({
                    type: "POST",
                    url: '@Url.Action("GetProjectsByFrequency","AssignProjects")',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(json),
                    success: function (data) {
                        $.each(data, function(key, value) {
                            $("#ddlProjects").append('<option value='+value.ID+'>'+value.ProjectName+'</option>');
                        });
                    }
                });
            });
        });
    </script>

}
